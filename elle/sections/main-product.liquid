{% comment %}
  Main Product Section - Elle Theme
  CRITICAL FOR THEME STORE: Full product page with all required blocks

  Required features implemented:
  - @app blocks support
  - All product blocks (title, price, vendor, description, variant_picker, etc.)
  - Dynamic checkout buttons (enabled by default)
  - Selling plans / subscriptions
  - Gift card recipient form
  - Pickup availability
  - Shop Pay Installments banner
{% endcomment %}

{%- liquid
  assign product = product
  assign current_variant = product.selected_or_first_available_variant
-%}

<section class="main-product section {% render 'color-scheme', scheme: section.settings.color_scheme %}">
  <div class="container">
    <div class="main-product__grid{% if section.settings.media_position == 'right' %} main-product__grid--reverse{% endif %}">
    {%- comment -%} Product Media Gallery {%- endcomment -%}
    <div class="main-product__media">
      {%- if product.media.size > 0 -%}
        <div class="product-gallery" data-product-gallery data-layout="{{ section.settings.gallery_layout }}">
          {%- if section.settings.gallery_layout == 'stacked' -%}
            {%- comment -%} ========== STACKED LAYOUT ========== {%- endcomment -%}
            {%- comment -%} All images displayed vertically, no slider {%- endcomment -%}
            <div class="product-gallery__stacked">
              {%- for media in product.media -%}
                <div class="product-gallery__stacked-item">
                  {%- case media.media_type -%}
                    {%- when 'image' -%}
                      {%- assign stacked_zoom_url = media | image_url: width: 2400 -%}
                      <div class="product-gallery__image media aspect-portrait">
                        <img
                          src="{{ media | image_url: width: 1200 }}"
                          srcset="{{ media | image_url: width: 375 }} 375w,
                                  {{ media | image_url: width: 550 }} 550w,
                                  {{ media | image_url: width: 750 }} 750w,
                                  {{ media | image_url: width: 1000 }} 1000w,
                                  {{ media | image_url: width: 1200 }} 1200w"
                          sizes="(min-width: 1200px) 50vw, 100vw"
                          alt="{{ media.alt | escape }}"
                          loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
                          fetchpriority="{% if forloop.first %}high{% else %}auto{% endif %}"
                          width="{{ media.width }}"
                          height="{{ media.height }}"
                          data-zoom-url="{{ stacked_zoom_url }}"
                        >
                      </div>
                      {%- if section.settings.enable_zoom -%}
                        <button
                          type="button"
                          class="product-gallery__zoom"
                          data-zoom-toggle
                          aria-label="{{ 'product.zoom' | t }}"
                        >
                          {% render 'icon', icon: 'zoom-in' %}
                        </button>
                      {%- endif -%}

                    {%- when 'video' -%}
                      <div class="product-gallery__video">
                        {{
                          media
                          | video_tag:
                            image_size: '1200x',
                            controls: true,
                            loop: section.settings.enable_video_looping,
                            muted: false
                        }}
                      </div>

                    {%- when 'external_video' -%}
                      <div class="product-gallery__video">
                        {%- if media.host == 'youtube' -%}
                          {{ media | external_video_url: autoplay: false, loop: section.settings.enable_video_looping | external_video_tag }}
                        {%- elsif media.host == 'vimeo' -%}
                          {{ media | external_video_url: autoplay: false, loop: section.settings.enable_video_looping | external_video_tag }}
                        {%- endif -%}
                      </div>

                    {%- when 'model' -%}
                      <div class="product-gallery__model">
                        {{ media | model_viewer_tag: reveal: 'interaction', toggleable: true }}
                      </div>
                  {%- endcase -%}
                </div>
              {%- endfor -%}
            </div>

          {%- else -%}
            {%- comment -%} ========== THUMBNAILS LAYOUT ========== {%- endcomment -%}
            {%- comment -%} Thumbnail sidebar + main slider {%- endcomment -%}

            {%- if product.media.size > 1 -%}
              {%- assign visible_thumbs = section.settings.visible_thumbnails | default: 4 -%}
              {%- assign extra_count = product.media.size | minus: visible_thumbs -%}
              <div class="product-gallery__thumbnails-wrapper" data-thumbnails-wrapper>
                <button
                  type="button"
                  class="product-gallery__thumb-nav product-gallery__thumb-nav--up"
                  data-thumb-nav="up"
                  aria-label="{{ 'accessibility.previous' | t }}"
                  hidden
                >
                  {% render 'icon', icon: 'chevron-up', size: 'sm' %}
                </button>

                <div class="product-gallery__thumbnails" data-thumbnails>
                  {%- for media in product.media -%}
                    <button
                      type="button"
                      class="product-gallery__thumbnail{% if forloop.first %} is-active{% endif %}{% if forloop.index > visible_thumbs %} is-overflow{% endif %}"
                      data-thumbnail-index="{{ forloop.index0 }}"
                      aria-label="{{ 'product.media_thumbnail' | t: index: forloop.index }}"
                    >
                      {%- if media.media_type == 'image' -%}
                        {{ media | image_url: width: 100 | image_tag: loading: 'lazy' }}
                      {%- elsif media.media_type == 'video' or media.media_type == 'external_video' -%}
                        <div class="product-gallery__thumbnail-video">
                          {{ media.preview_image | image_url: width: 100 | image_tag: loading: 'lazy' }}
                          {% render 'icon', icon: 'play', size: 'sm' %}
                        </div>
                      {%- elsif media.media_type == 'model' -%}
                        <div class="product-gallery__thumbnail-model">
                          {{ media.preview_image | image_url: width: 100 | image_tag: loading: 'lazy' }}
                        </div>
                      {%- endif -%}
                    </button>
                  {%- endfor -%}
                </div>

                {%- if extra_count > 0 -%}
                  <button
                    type="button"
                    class="product-gallery__thumb-nav product-gallery__thumb-nav--down"
                    data-thumb-nav="down"
                    data-extra-count="{{ extra_count }}"
                    aria-label="{{ 'accessibility.next' | t }}"
                  >
                    <span class="product-gallery__more-text" data-more-text>{{ 'product.more_images' | t: count: extra_count | default: 'MORE' }} ({{ extra_count }})</span>
                    {% render 'icon', icon: 'chevron-down', size: 'sm' %}
                  </button>
                {%- endif -%}
              </div>
            {%- endif -%}

            {%- comment -%} Main Media Slider {%- endcomment -%}
            <div class="product-gallery__main" data-main-media>
              {%- for media in product.media -%}
                <div
                  class="product-gallery__slide{% if forloop.first %} is-active{% endif %}"
                  data-media-id="{{ media.id }}"
                  data-slide-index="{{ forloop.index0 }}"
                  {% unless forloop.first %}hidden{% endunless %}
                >
                  {%- case media.media_type -%}
                    {%- when 'image' -%}
                      {%- assign zoom_url = media | image_url: width: 2400 -%}
                      <div class="product-gallery__image media aspect-portrait">
                        <img
                          src="{{ media | image_url: width: 1200 }}"
                          srcset="{{ media | image_url: width: 375 }} 375w,
                                  {{ media | image_url: width: 550 }} 550w,
                                  {{ media | image_url: width: 750 }} 750w,
                                  {{ media | image_url: width: 1000 }} 1000w,
                                  {{ media | image_url: width: 1200 }} 1200w"
                          sizes="(min-width: 1200px) 50vw, 100vw"
                          alt="{{ media.alt | escape }}"
                          loading="eager"
                          fetchpriority="high"
                          width="{{ media.width }}"
                          height="{{ media.height }}"
                          data-zoom-url="{{ zoom_url }}"
                        >
                      </div>

                    {%- when 'video' -%}
                      <div class="product-gallery__video">
                        {{
                          media
                          | video_tag:
                            image_size: '1200x',
                            controls: true,
                            loop: section.settings.enable_video_looping,
                            muted: false
                        }}
                      </div>

                    {%- when 'external_video' -%}
                      <div class="product-gallery__video">
                        {%- if media.host == 'youtube' -%}
                          {{ media | external_video_url: autoplay: false, loop: section.settings.enable_video_looping | external_video_tag }}
                        {%- elsif media.host == 'vimeo' -%}
                          {{ media | external_video_url: autoplay: false, loop: section.settings.enable_video_looping | external_video_tag }}
                        {%- endif -%}
                      </div>

                    {%- when 'model' -%}
                      <div class="product-gallery__model">
                        {{ media | model_viewer_tag: reveal: 'interaction', toggleable: true }}
                      </div>
                  {%- endcase -%}
                </div>
              {%- endfor -%}

              {%- if product.media.size > 1 -%}
                {%- if section.settings.show_nav_arrows -%}
                  <button
                    type="button"
                    class="product-gallery__nav product-gallery__nav--prev"
                    data-gallery-nav="prev"
                    aria-label="{{ 'accessibility.previous' | t }}"
                  >
                    {% render 'icon', icon: 'chevron-left' %}
                  </button>
                  <button
                    type="button"
                    class="product-gallery__nav product-gallery__nav--next"
                    data-gallery-nav="next"
                    aria-label="{{ 'accessibility.next' | t }}"
                  >
                    {% render 'icon', icon: 'chevron-right' %}
                  </button>
                {%- endif -%}
                {%- if section.settings.show_image_counter -%}
                  <div class="product-gallery__counter" aria-live="polite" aria-atomic="true">
                    <span data-gallery-current>1</span>
                    <span class="product-gallery__counter-sep">/</span>
                    <span data-gallery-total>{{ product.media.size }}</span>
                  </div>
                {%- endif -%}
              {%- endif -%}

              {%- if section.settings.enable_zoom -%}
                <button
                  type="button"
                  class="product-gallery__zoom"
                  data-zoom-toggle
                  aria-label="{{ 'product.zoom' | t }}"
                >
                  {% render 'icon', icon: 'zoom-in' %}
                </button>
              {%- endif -%}
            </div>
          {%- endif -%}

          {%- comment -%} Zoom Modal - must be inside product-gallery for JS to find it {%- endcomment -%}
          {%- if section.settings.enable_zoom -%}
            <dialog class="product-gallery__zoom-modal" data-zoom-modal>
              <div class="product-gallery__zoom-modal-content">
                <img src="" alt="" data-zoom-image>
              </div>
              <button type="button" class="product-gallery__zoom-close btn btn--icon" data-zoom-close aria-label="{{ 'accessibility.close' | t }}">
                {% render 'icon', icon: 'close' %}
              </button>
            </dialog>
          {%- endif -%}
        </div>
      {%- else -%}
        <div class="product-gallery__placeholder media aspect-portrait">
          {{ 'product-1' | placeholder_svg_tag }}
        </div>
      {%- endif -%}
    </div>

    {%- comment -%} Product Info {%- endcomment -%}
    <div class="main-product__info{% if section.settings.enable_sticky %} main-product__info--sticky{% endif %}">
      {%- comment -%} Product Form {%- endcomment -%}
      {%- form 'product',
        product,
        id: 'product-form',
        data-product-form: '',
        data-product-id: product.id,
        data-product-handle: product.handle
      -%}
        {%- for block in section.blocks -%}
          {%- case block.type -%}
            {%- comment -%} ======== VENDOR ======== {%- endcomment -%}
            {%- when 'vendor' -%}
              {%- if product.vendor != blank -%}
                <p class="product-info__vendor subheading spacing-bottom--{{ block.settings.spacing_bottom }}" {{ block.shopify_attributes }}>
                  {{ product.vendor }}
                </p>
              {%- endif -%}

            {%- comment -%} ======== TITLE ======== {%- endcomment -%}
            {%- when 'title' -%}
              <h1 class="product-info__title product-info__title--{{ block.settings.title_size }} spacing-bottom--{{ block.settings.spacing_bottom }}" {{ block.shopify_attributes }}>
                {{ product.title }}
              </h1>

            {%- comment -%} ======== PRICE ======== {%- endcomment -%}
            {%- when 'price' -%}
              <div class="product-info__price product-info__price--{{ block.settings.price_size }} spacing-bottom--{{ block.settings.spacing_bottom }}" {{ block.shopify_attributes }} data-product-price>
                {% render 'price', product: product %}

                {%- comment -%} Shop Pay Installments Banner {%- endcomment -%}
                {%- if block.settings.show_installments -%}
                  {{ form | payment_terms }}
                {%- endif -%}
              </div>

            {%- comment -%} ======== DESCRIPTION ======== {%- endcomment -%}
            {%- when 'description' -%}
              {%- if product.description != blank -%}
                <div class="product-info__description rte spacing-bottom--{{ block.settings.spacing_bottom }}" {{ block.shopify_attributes }}>
                  {{ product.description }}
                </div>
              {%- endif -%}

            {%- comment -%} ======== VARIANT PICKER ======== {%- endcomment -%}
            {%- when 'variant_picker' -%}
              {%- unless product.has_only_default_variant -%}
                <div class="variant-picker spacing-bottom--{{ block.settings.spacing_bottom }}" {{ block.shopify_attributes }} data-variant-picker>
                  {%- for option in product.options_with_values -%}
                    {%- liquid
                      assign option_index = forloop.index0
                      assign option_name_downcase = option.name | downcase
                      assign is_color = false
                      if option_name_downcase == 'color' or option_name_downcase == 'colour'
                        assign is_color = true
                      endif
                    -%}

                    <div class="variant-picker__option" data-option-index="{{ option_index }}">
                      <label class="variant-picker__label">
                        {{ option.name }}:
                        <span data-selected-value>{{ option.selected_value }}</span>
                      </label>

                      {%- if block.settings.style == 'dropdown' -%}
                        <select
                          class="form-select variant-picker__select"
                          name="options[{{ option.name }}]"
                          data-option-select
                        >
                          {%- for value in option.values -%}
                            <option
                              value="{{ value }}"
                              {% if value == option.selected_value %}selected{% endif %}
                            >
                              {{ value }}
                            </option>
                          {%- endfor -%}
                        </select>

                      {%- else -%}
                        <div class="variant-picker__values">
                          {%- for value in option.values -%}
                            {%- liquid
                              assign variant_for_value = product.variants | where: option.name, value | first
                              assign is_available = variant_for_value.available
                            -%}

                            {%- if is_color and block.settings.swatch_type != 'none' -%}
                              {%- liquid
                                assign swatch_color = value | handle | replace: '-', ''
                                assign swatch_image = ''
                                if block.settings.swatch_type == 'image' and variant_for_value.featured_image
                                  assign swatch_image = variant_for_value.featured_image | image_url: width: 50
                                endif
                              -%}
                              <button
                                type="button"
                                class="variant-picker__swatch{% if value == option.selected_value %} is-selected{% endif %}{% unless is_available %} is-unavailable{% endunless %}"
                                data-value="{{ value }}"
                                style="--swatch-color: {{ swatch_color }};{% if swatch_image != blank %} --swatch-image: url('{{ swatch_image }}');{% endif %}"
                                title="{{ value }}"
                                {% unless is_available %}disabled{% endunless %}
                              >
                                <span class="visually-hidden">{{ value }}</span>
                              </button>
                            {%- else -%}
                              <button
                                type="button"
                                class="variant-picker__value{% if value == option.selected_value %} is-selected{% endif %}{% unless is_available %} is-unavailable{% endunless %}"
                                data-value="{{ value }}"
                                {% unless is_available %}disabled{% endunless %}
                              >
                                {{ value }}
                              </button>
                            {%- endif -%}
                          {%- endfor -%}
                        </div>
                      {%- endif -%}
                    </div>
                  {%- endfor -%}

                  <select name="id" class="visually-hidden" data-variant-select>
                    {%- for variant in product.variants -%}
                      <option
                        value="{{ variant.id }}"
                        {% if variant == current_variant %}selected{% endif %}
                        data-available="{{ variant.available }}"
                      >
                        {{ variant.title }} - {{ variant.price | money }}
                      </option>
                    {%- endfor -%}
                  </select>
                </div>
              {%- else -%}
                <input type="hidden" name="id" value="{{ current_variant.id }}">
              {%- endunless -%}

            {%- comment -%} ======== QUANTITY SELECTOR ======== {%- endcomment -%}
            {%- when 'quantity_selector' -%}
              <div class="product-info__quantity spacing-bottom--{{ block.settings.spacing_bottom }}" {{ block.shopify_attributes }}>
                <label class="form-label" for="quantity">{{ 'product.quantity' | t }}</label>
                <div class="quantity-input">
                  <button
                    type="button"
                    class="quantity-input__button"
                    data-quantity-minus
                    aria-label="{{ 'product.decrease_quantity' | t }}"
                  >
                    {% render 'icon', icon: 'minus' %}
                  </button>
                  <input
                    type="number"
                    id="quantity"
                    name="quantity"
                    class="quantity-input__field"
                    value="1"
                    min="1"
                    aria-label="{{ 'product.quantity' | t }}"
                  >
                  <button
                    type="button"
                    class="quantity-input__button"
                    data-quantity-plus
                    aria-label="{{ 'product.increase_quantity' | t }}"
                  >
                    {% render 'icon', icon: 'plus' %}
                  </button>
                </div>
              </div>

            {%- comment -%} ======== BUY BUTTONS (CRITICAL) ======== {%- endcomment -%}
            {%- when 'buy_buttons' -%}
              <div class="product-info__buy-buttons buy-buttons spacing-bottom--{{ block.settings.spacing_bottom }}" {{ block.shopify_attributes }}>
                {%- comment -%} Gift Card Recipient Form {%- endcomment -%}
                {%- if product.gift_card? -%}
                  <div class="gift-card-recipient">
                    <div class="form-group">
                      <input
                        type="checkbox"
                        id="gift-card-recipient"
                        name="properties[__shopify_send_gift_card_to_recipient]"
                        class="form-checkbox"
                      >
                      <label for="gift-card-recipient">{{ 'gift_card.recipient.checkbox' | t }}</label>
                    </div>
                    <div class="gift-card-recipient__fields" hidden data-gift-card-fields>
                      <div class="form-group">
                        <label for="gift-card-recipient-email" class="form-label">
                          {{ 'gift_card.recipient.email_label' | t }}
                        </label>
                        <input
                          type="email"
                          id="gift-card-recipient-email"
                          name="properties[Recipient email]"
                          class="form-input"
                          placeholder="{{ 'gift_card.recipient.email_placeholder' | t }}"
                        >
                      </div>
                      <div class="form-group">
                        <label for="gift-card-recipient-name" class="form-label">
                          {{ 'gift_card.recipient.name_label' | t }}
                        </label>
                        <input
                          type="text"
                          id="gift-card-recipient-name"
                          name="properties[Recipient name]"
                          class="form-input"
                          placeholder="{{ 'gift_card.recipient.name_placeholder' | t }}"
                        >
                      </div>
                      <div class="form-group">
                        <label for="gift-card-recipient-message" class="form-label">
                          {{ 'gift_card.recipient.message_label' | t }}
                        </label>
                        <textarea
                          id="gift-card-recipient-message"
                          name="properties[Message]"
                          class="form-textarea"
                          rows="3"
                          placeholder="{{ 'gift_card.recipient.message_placeholder' | t }}"
                          maxlength="200"
                        ></textarea>
                      </div>
                      <div class="form-group">
                        <label for="gift-card-recipient-send-on" class="form-label">
                          {{ 'gift_card.recipient.send_on_label' | t }}
                        </label>
                        <input
                          type="date"
                          id="gift-card-recipient-send-on"
                          name="properties[Send on]"
                          class="form-input"
                        >
                      </div>
                    </div>
                  </div>
                {%- endif -%}

                {%- comment -%} Selling Plans / Subscriptions {%- endcomment -%}
                {%- if product.selling_plan_groups.size > 0 -%}
                  <div class="selling-plan-picker" data-selling-plan-picker>
                    {%- for group in product.selling_plan_groups -%}
                      <fieldset class="selling-plan-group">
                        <legend class="form-label">{{ group.name }}</legend>
                        <div class="selling-plan-options">
                          <label class="selling-plan-option">
                            <input
                              type="radio"
                              name="selling_plan"
                              value=""
                              checked
                              class="form-radio"
                            >
                            <span>{{ 'product.one_time_purchase' | t }}</span>
                          </label>
                          {%- for plan in group.selling_plans -%}
                            <label class="selling-plan-option">
                              <input
                                type="radio"
                                name="selling_plan"
                                value="{{ plan.id }}"
                                class="form-radio"
                              >
                              <span>{{ plan.name }}</span>
                              {%- if plan.price_adjustments.size > 0 -%}
                                <span class="selling-plan-option__price">
                                  {{ plan.price_adjustments[0].value | money }}
                                </span>
                              {%- endif -%}
                            </label>
                          {%- endfor -%}
                        </div>
                      </fieldset>
                    {%- endfor -%}
                  </div>
                {%- endif -%}

                {%- comment -%} Add to Cart Button {%- endcomment -%}
                <button
                  type="submit"
                  name="add"
                  class="btn btn--filled btn--full btn--lg"
                  {% unless current_variant.available %}disabled{% endunless %}
                  data-add-to-cart
                >
                  <span data-add-to-cart-text>
                    {%- if current_variant.available -%}
                      {{ 'product.add_to_cart' | t }}
                    {%- else -%}
                      {{ 'product.sold_out' | t }}
                    {%- endif -%}
                  </span>
                </button>

                {%- comment -%} Dynamic Checkout Buttons (REQUIRED - enabled by default) {%- endcomment -%}
                {%- if block.settings.show_dynamic_checkout -%}
                  {{ form | payment_button }}
                {%- endif -%}
              </div>

            {%- comment -%} ======== INVENTORY ======== {%- endcomment -%}
            {%- when 'inventory' -%}
              <div class="product-info__inventory spacing-bottom--{{ block.settings.spacing_bottom }}" {{ block.shopify_attributes }} data-inventory-status>
                {%- if current_variant.available -%}
                  {%- if current_variant.inventory_management and current_variant.inventory_quantity <= block.settings.inventory_threshold -%}
                    <p class="product-info__inventory-low">
                      {%- if block.settings.indicator_style == 'dot' -%}
                        <span class="inventory-dot inventory-dot--low-stock"></span>
                      {%- else -%}
                        {% render 'icon', icon: 'alert-circle', size: 'sm' %}
                      {%- endif -%}
                      {%- if block.settings.show_count -%}
                        {{ 'product.low_stock_count' | t: count: current_variant.inventory_quantity }}
                      {%- else -%}
                        {{ 'product.low_stock' | t }}
                      {%- endif -%}
                    </p>
                  {%- else -%}
                    <p class="product-info__inventory-in-stock">
                      {%- if block.settings.indicator_style == 'dot' -%}
                        <span class="inventory-dot inventory-dot--in-stock"></span>
                      {%- else -%}
                        {% render 'icon', icon: 'check-circle', size: 'sm' %}
                      {%- endif -%}
                      {{ 'product.in_stock' | t }}
                    </p>
                  {%- endif -%}
                {%- else -%}
                  <p class="product-info__inventory-out-of-stock">
                    {{ 'product.out_of_stock' | t }}
                  </p>
                {%- endif -%}
              </div>

            {%- comment -%} ======== PICKUP AVAILABILITY ======== {%- endcomment -%}
            {%- when 'pickup_availability' -%}
              <div
                class="product-info__pickup spacing-bottom--{{ block.settings.spacing_bottom }}"
                {{ block.shopify_attributes }}
                data-pickup-availability-container
                data-base-url="{{ routes.root_url }}"
              ></div>

            {%- comment -%} ======== SKU ======== {%- endcomment -%}
            {%- when 'sku' -%}
              {%- if current_variant.sku != blank -%}
                <p class="product-info__sku text-sm text-muted spacing-bottom--{{ block.settings.spacing_bottom }}" {{ block.shopify_attributes }} data-product-sku>
                  {{ 'product.sku' | t }}: {{ current_variant.sku }}
                </p>
              {%- endif -%}

            {%- comment -%} ======== RATING ======== {%- endcomment -%}
            {%- when 'rating' -%}
              {%- if product.metafields.reviews.rating.value != blank -%}
                <div class="product-info__rating spacing-bottom--{{ block.settings.spacing_bottom }}" {{ block.shopify_attributes }}>
                  {%- assign rating = product.metafields.reviews.rating.value | plus: 0 -%}
                  {%- assign rating_count = product.metafields.reviews.rating_count.value -%}
                  {%- assign rating_floor = rating | floor -%}
                  {%- assign rating_decimal = rating | modulo: 1 -%}
                  {%- assign rating_half_star_position = rating_floor | plus: 1 -%}
                  <div class="product-rating" role="img" aria-label="{{ rating }} out of 5 stars">
                    {%- for i in (1..5) -%}
                      {%- if i <= rating_floor -%}
                        {% render 'icon', icon: 'star-filled', size: 'sm' %}
                      {%- elsif i == rating_half_star_position and rating_decimal >= 0.5 -%}
                        {% render 'icon', icon: 'star-half', size: 'sm' %}
                      {%- else -%}
                        {% render 'icon', icon: 'star', size: 'sm' %}
                      {%- endif -%}
                    {%- endfor -%}
                    {%- if rating_count -%}
                      <span class="product-rating__count">({{ rating_count }})</span>
                    {%- endif -%}
                  </div>
                </div>
              {%- endif -%}

            {%- comment -%} ======== SHARE ======== {%- endcomment -%}
            {%- when 'share' -%}
              <div class="product-info__share spacing-bottom--{{ block.settings.spacing_bottom }}" {{ block.shopify_attributes }}>
                {% render 'social-share',
                  share_title: product.title,
                  share_url: product.url,
                  share_image: product.featured_image,
                  show_facebook: block.settings.show_facebook,
                  show_twitter: block.settings.show_twitter,
                  show_pinterest: block.settings.show_pinterest,
                  show_email: block.settings.show_email
                %}
              </div>

            {%- comment -%} ======== COLLAPSIBLE TAB ======== {%- endcomment -%}
            {%- when 'collapsible_tab' -%}
              <details class="product-info__collapsible spacing-bottom--{{ block.settings.spacing_bottom }}" {{ block.shopify_attributes }}>
                <summary class="product-info__collapsible-summary">
                  {%- if block.settings.icon != 'none' -%}
                    {% render 'icon', icon: block.settings.icon %}
                  {%- endif -%}
                  <span>{{ block.settings.heading | default: 'Tab' }}</span>
                  {% render 'icon', icon: 'chevron-down', size: 'sm' %}
                </summary>
                <div class="product-info__collapsible-content rte">
                  {%- if block.settings.page != blank -%}
                    {{ block.settings.page.content }}
                  {%- else -%}
                    {{ block.settings.content }}
                  {%- endif -%}
                </div>
              </details>

            {%- comment -%} ======== POPUP ======== {%- endcomment -%}
            {%- when 'popup' -%}
              {%- if block.settings.page != blank -%}
                <div class="product-info__popup spacing-bottom--{{ block.settings.spacing_bottom }}" {{ block.shopify_attributes }}>
                  <button
                    type="button"
                    class="product-info__popup-trigger link"
                    data-popup-trigger="{{ block.id }}"
                  >
                    {{ block.settings.link_label | default: 'Size guide' }}
                  </button>
                  <dialog class="product-info__popup-dialog" id="popup-{{ block.id }}">
                    <div class="product-info__popup-header">
                      <h3>{{ block.settings.page.title }}</h3>
                      <button type="button" class="btn btn--icon" data-popup-close>
                        {% render 'icon', icon: 'close' %}
                      </button>
                    </div>
                    <div class="product-info__popup-content rte">
                      {{ block.settings.page.content }}
                    </div>
                  </dialog>
                </div>
              {%- endif -%}

            {%- comment -%} ======== COMPLEMENTARY PRODUCTS ======== {%- endcomment -%}
            {%- when 'complementary' -%}
              {%- if recommendations.performed and recommendations.products_count > 0 -%}
                <div class="product-info__complementary spacing-bottom--{{ block.settings.spacing_bottom }}" {{ block.shopify_attributes }}>
                  <h3 class="product-info__complementary-heading h6">
                    {{ block.settings.heading | default: 'Complete the look' }}
                  </h3>
                  <div
                    class="product-info__complementary-products"
                    style="--complementary-columns: {{ block.settings.columns | default: 2 }};"
                  >
                    {%- for product in recommendations.products limit: block.settings.products_to_show -%}
                      {% render 'product-card', product: product %}
                    {%- endfor -%}
                  </div>
                </div>
              {%- endif -%}

            {%- comment -%} ======== CUSTOM LIQUID ======== {%- endcomment -%}
            {%- when 'custom_liquid' -%}
              <div class="product-info__custom-liquid spacing-bottom--{{ block.settings.spacing_bottom }}" {{ block.shopify_attributes }}>
                {{ block.settings.liquid }}
              </div>

            {%- comment -%} ======== TEXT ======== {%- endcomment -%}
            {%- when 'text' -%}
              <div
                class="product-info__text{% if block.settings.text_style == 'small' %} text-sm{% elsif block.settings.text_style == 'uppercase' %} subheading{% endif %} spacing-bottom--{{ block.settings.spacing_bottom }}"
                {{ block.shopify_attributes }}
              >
                {{ block.settings.text }}
              </div>

            {%- comment -%} ======== TRUST BADGES ======== {%- endcomment -%}
            {%- when 'trust_badges' -%}
              <div class="product-info__trust-badges spacing-bottom--{{ block.settings.spacing_bottom }}" {{ block.shopify_attributes }}>
                {%- if block.settings.show_shipping -%}
                  <div class="trust-badge">
                    {% render 'icon', icon: 'truck', size: 'sm' %}
                    <span>{{ block.settings.shipping_text | default: 'Free shipping' }}</span>
                  </div>
                {%- endif -%}
                {%- if block.settings.show_returns -%}
                  <div class="trust-badge">
                    {% render 'icon', icon: 'refresh', size: 'sm' %}
                    <span>{{ block.settings.returns_text | default: 'Easy returns' }}</span>
                  </div>
                {%- endif -%}
                {%- if block.settings.show_secure -%}
                  <div class="trust-badge">
                    {% render 'icon', icon: 'lock', size: 'sm' %}
                    <span>{{ block.settings.secure_text | default: 'Secure checkout' }}</span>
                  </div>
                {%- endif -%}
              </div>

            {%- comment -%} ======== DIVIDER ======== {%- endcomment -%}
            {%- when 'divider' -%}
              <hr class="product-info__divider divider spacing-bottom--{{ block.settings.spacing_bottom }}" {{ block.shopify_attributes }}>

            {%- comment -%} ======== APP BLOCKS (REQUIRED) ======== {%- endcomment -%}
            {%- when '@app' -%}
              <div class="product-info__app-block" {{ block.shopify_attributes }}>
                {% render block %}
              </div>
          {%- endcase -%}
        {%- endfor -%}
      {%- endform -%}
    </div>
  </div>
  </div>
</section>

{%- comment -%} Product JSON for JavaScript {%- endcomment -%}
<script type="application/json" data-product-json>
  {{ product | json }}
</script>

<script>
  // Product form functionality
  (function() {
    const form = document.querySelector('[data-product-form]');
    if (!form) return;

    const productJson = JSON.parse(document.querySelector('[data-product-json]').textContent);
    const variantSelect = form.querySelector('[data-variant-select]');
    const variantPicker = form.querySelector('[data-variant-picker]');
    const addToCartBtn = form.querySelector('[data-add-to-cart]');
    const addToCartText = form.querySelector('[data-add-to-cart-text]');
    const priceContainer = form.querySelector('[data-product-price]');

    // Quantity buttons
    const quantityMinus = form.querySelector('[data-quantity-minus]');
    const quantityPlus = form.querySelector('[data-quantity-plus]');
    const quantityInput = form.querySelector('input[name="quantity"]');

    if (quantityMinus && quantityPlus && quantityInput) {
      quantityMinus.addEventListener('click', () => {
        const value = parseInt(quantityInput.value);
        if (value > 1) quantityInput.value = value - 1;
      });
      quantityPlus.addEventListener('click', () => {
        quantityInput.value = parseInt(quantityInput.value) + 1;
      });
    }

    // Variant picker buttons
    if (variantPicker) {
      variantPicker.querySelectorAll('button[data-value], select[data-option-select]').forEach(element => {
        element.addEventListener(element.tagName === 'SELECT' ? 'change' : 'click', (e) => {
          const optionContainer = e.target.closest('[data-option-index]');
          const optionIndex = parseInt(optionContainer.dataset.optionIndex);
          const value = element.tagName === 'SELECT' ? element.value : element.dataset.value;

          // Update selected state
          if (element.tagName !== 'SELECT') {
            optionContainer.querySelectorAll('button').forEach(btn => btn.classList.remove('is-selected'));
            element.classList.add('is-selected');
          }

          // Update selected value display
          const selectedValueDisplay = optionContainer.querySelector('[data-selected-value]');
          if (selectedValueDisplay) selectedValueDisplay.textContent = value;

          // Find matching variant
          updateVariant();
        });
      });
    }

    function updateVariant() {
      const selectedOptions = [];
      variantPicker.querySelectorAll('[data-option-index]').forEach(option => {
        const select = option.querySelector('select');
        const selectedBtn = option.querySelector('button.is-selected');
        if (select) {
          selectedOptions.push(select.value);
        } else if (selectedBtn) {
          selectedOptions.push(selectedBtn.dataset.value);
        }
      });

      const variant = productJson.variants.find(v => {
        return selectedOptions.every((opt, index) => v.options[index] === opt);
      });

      if (variant) {
        variantSelect.value = variant.id;
        updateAddToCart(variant);
        updateUrl(variant);

        // Dispatch event for other components (pickup availability, etc.)
        document.dispatchEvent(new CustomEvent('product:variant-changed', {
          detail: { variantId: variant.id, variant: variant }
        }));
      }
    }

    function updateAddToCart(variant) {
      if (variant.available) {
        addToCartBtn.disabled = false;
        addToCartText.textContent = '{{ "product.add_to_cart" | t }}';
      } else {
        addToCartBtn.disabled = true;
        addToCartText.textContent = '{{ "product.sold_out" | t }}';
      }
    }

    function updateUrl(variant) {
      const url = new URL(window.location);
      url.searchParams.set('variant', variant.id);
      window.history.replaceState({}, '', url);
    }

    // Gift card recipient toggle
    const giftCardCheckbox = form.querySelector('#gift-card-recipient');
    const giftCardFields = form.querySelector('[data-gift-card-fields]');
    if (giftCardCheckbox && giftCardFields) {
      giftCardCheckbox.addEventListener('change', () => {
        giftCardFields.hidden = !giftCardCheckbox.checked;
      });
    }

    // Popup functionality
    document.querySelectorAll('[data-popup-trigger]').forEach(trigger => {
      const dialogId = trigger.dataset.popupTrigger;
      const dialog = document.getElementById('popup-' + dialogId);
      if (dialog) {
        trigger.addEventListener('click', () => dialog.showModal());
        dialog.querySelector('[data-popup-close]').addEventListener('click', () => dialog.close());
      }
    });

    // Pickup Availability - fetches and renders via Section Rendering API
    const pickupContainer = document.querySelector('[data-pickup-availability-container]');
    if (pickupContainer) {
      const baseUrl = pickupContainer.dataset.baseUrl || '/';

      function initPickupModal() {
        const openBtn = pickupContainer.querySelector('[data-pickup-modal-open]');
        const modal = pickupContainer.querySelector('[data-pickup-modal]');
        const closeBtn = pickupContainer.querySelector('[data-pickup-modal-close]');

        if (openBtn && modal) {
          openBtn.addEventListener('click', () => modal.showModal());

          if (closeBtn) {
            closeBtn.addEventListener('click', () => modal.close());
          }

          modal.addEventListener('click', (e) => {
            if (e.target === modal) modal.close();
          });
        }
      }

      function updatePickupAvailability(variantId) {
        if (!variantId) {
          pickupContainer.innerHTML = '';
          return;
        }

        fetch(`${baseUrl}variants/${variantId}/?section_id=pickup-availability`)
          .then(response => response.text())
          .then(html => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const content = doc.querySelector('.shopify-section');
            pickupContainer.innerHTML = content ? content.innerHTML : '';
            // Initialize modal after content is loaded
            initPickupModal();
          })
          .catch(() => {
            pickupContainer.innerHTML = '';
          });
      }

      // Initial load with current variant
      const initialVariantId = variantSelect ? variantSelect.value : null;
      if (initialVariantId) {
        updatePickupAvailability(initialVariantId);
      }

      // Listen for variant changes from our updateVariant function
      document.addEventListener('product:variant-changed', (e) => {
        if (e.detail && e.detail.variantId) {
          updatePickupAvailability(e.detail.variantId);
        }
      });
    }

    // AJAX Add to Cart - opens cart drawer instead of redirecting
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData(form);

      // Disable button and show loading state
      addToCartBtn.disabled = true;
      const originalText = addToCartText.textContent;
      addToCartText.textContent = '{{ "product.adding" | t | default: "Adding..." }}';

      try {
        // Build cart item from form data
        const cartItem = {
          id: parseInt(formData.get('id')),
          quantity: parseInt(formData.get('quantity') || 1)
        };

        // Include selling plan if present
        const sellingPlan = formData.get('selling_plan');
        if (sellingPlan) {
          cartItem.selling_plan = parseInt(sellingPlan);
        }

        // Use JSON format with sections parameter for reliable section rendering
        const response = await fetch('/cart/add.js', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            items: [cartItem],
            sections: 'cart-drawer',
            sections_url: window.location.pathname
          })
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.description || 'Failed to add to cart');
        }

        const data = await response.json();

        // Update cart count in header
        const cartResponse = await fetch('/cart.js');
        const cartData = await cartResponse.json();
        const cartCounts = document.querySelectorAll('[data-cart-count]');
        cartCounts.forEach(el => {
          if (el.closest('.cart-drawer')) {
            el.textContent = `(${cartData.item_count})`;
          } else {
            el.textContent = cartData.item_count;
          }
        });

        // Update drawer with returned section HTML
        const cartDrawer = document.querySelector('[data-cart-drawer]');
        if (data.sections && data.sections['cart-drawer'] && cartDrawer) {
          const parser = new DOMParser();
          const doc = parser.parseFromString(data.sections['cart-drawer'], 'text/html');
          const newDrawer = doc.querySelector('[data-cart-drawer]');
          if (newDrawer) {
            cartDrawer.innerHTML = newDrawer.innerHTML;
          }
        }

        // Open cart drawer
        if (typeof window.openCartDrawer === 'function') {
          window.openCartDrawer();
        }

        // Brief success state
        addToCartText.textContent = '{{ "product.added" | t | default: "Added!" }}';
        setTimeout(() => {
          addToCartText.textContent = originalText;
          addToCartBtn.disabled = false;
        }, 1500);

      } catch (error) {
        console.error('Add to cart error:', error);
        addToCartText.textContent = error.message || '{{ "product.error" | t | default: "Error" }}';
        setTimeout(() => {
          addToCartText.textContent = originalText;
          addToCartBtn.disabled = false;
        }, 2000);
      }
    });
  })();

  // Gallery Navigation - separate from form to ensure it always runs
  (function() {
    const gallery = document.querySelector('[data-product-gallery]');
    if (!gallery) return;

    const mainMedia = gallery.querySelector('[data-main-media]');
    const thumbnails = gallery.querySelectorAll('[data-thumbnail-index]');
    const slides = gallery.querySelectorAll('[data-slide-index]');
    const prevBtn = gallery.querySelector('[data-gallery-nav="prev"]');
    const nextBtn = gallery.querySelector('[data-gallery-nav="next"]');
    const currentCounter = gallery.querySelector('[data-gallery-current]');
    const totalCount = slides.length;

    let currentIndex = 0;

    function goToSlide(index) {
      // Loop around
      if (index < 0) index = totalCount - 1;
      if (index >= totalCount) index = 0;

      // Update slides
      slides.forEach((slide, i) => {
        const isActive = i === index;
        slide.classList.toggle('is-active', isActive);
        slide.hidden = !isActive;
      });

      // Update thumbnails
      thumbnails.forEach((thumb, i) => {
        thumb.classList.toggle('is-active', i === index);
      });

      // Update counter
      if (currentCounter) {
        currentCounter.textContent = index + 1;
      }

      currentIndex = index;
    }

    // Thumbnail clicks
    thumbnails.forEach(thumb => {
      thumb.addEventListener('click', () => {
        const index = parseInt(thumb.dataset.thumbnailIndex);
        goToSlide(index);
      });
    });

    // Prev/Next button clicks
    if (prevBtn) {
      prevBtn.addEventListener('click', () => goToSlide(currentIndex - 1));
    }
    if (nextBtn) {
      nextBtn.addEventListener('click', () => goToSlide(currentIndex + 1));
    }

    // Keyboard navigation
    if (mainMedia) {
      mainMedia.setAttribute('tabindex', '0');
      mainMedia.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') {
          e.preventDefault();
          goToSlide(currentIndex - 1);
        } else if (e.key === 'ArrowRight') {
          e.preventDefault();
          goToSlide(currentIndex + 1);
        }
      });
    }

    // Touch swipe support
    let touchStartX = 0;
    const SWIPE_THRESHOLD = 50;

    if (mainMedia) {
      mainMedia.addEventListener('touchstart', (e) => {
        touchStartX = e.changedTouches[0].screenX;
      }, { passive: true });

      mainMedia.addEventListener('touchend', (e) => {
        const touchEndX = e.changedTouches[0].screenX;
        const diff = touchStartX - touchEndX;

        if (Math.abs(diff) > SWIPE_THRESHOLD) {
          if (diff > 0) {
            goToSlide(currentIndex + 1); // Swipe left = next
          } else {
            goToSlide(currentIndex - 1); // Swipe right = prev
          }
        }
      }, { passive: true });
    }

    // Thumbnail overflow expand/collapse
    const thumbnailsWrapper = gallery.querySelector('[data-thumbnails-wrapper]');
    if (thumbnailsWrapper) {
      const thumbnailsContainer = thumbnailsWrapper.querySelector('[data-thumbnails]');
      const upNav = thumbnailsWrapper.querySelector('[data-thumb-nav="up"]');
      const downNav = thumbnailsWrapper.querySelector('[data-thumb-nav="down"]');
      let isExpanded = false;

      if (downNav) {
        downNav.addEventListener('click', () => {
          isExpanded = !isExpanded;
          thumbnailsContainer.classList.toggle('is-expanded', isExpanded);
          downNav.classList.toggle('is-expanded', isExpanded);

          if (upNav) {
            upNav.hidden = !isExpanded;
          }
        });
      }

      if (upNav) {
        upNav.addEventListener('click', () => {
          isExpanded = false;
          thumbnailsContainer.classList.remove('is-expanded');
          downNav.classList.remove('is-expanded');
          upNav.hidden = true;
        });
      }
    }

    // Image Zoom functionality
    const zoomModal = gallery.querySelector('[data-zoom-modal]');
    const zoomImage = gallery.querySelector('[data-zoom-image]');
    const zoomClose = gallery.querySelector('[data-zoom-close]');
    const zoomToggles = gallery.querySelectorAll('[data-zoom-toggle]');

    if (zoomModal && zoomImage) {
      zoomToggles.forEach(toggle => {
        toggle.addEventListener('click', (e) => {
          let img = null;

          // Check if we're in stacked layout (button is inside stacked-item)
          const stackedItem = toggle.closest('.product-gallery__stacked-item');
          if (stackedItem) {
            img = stackedItem.querySelector('img[data-zoom-url]');
          } else {
            // Thumbnails layout - find image in the active slide
            const mainGallery = toggle.closest('.product-gallery__main');
            if (mainGallery) {
              const activeSlide = mainGallery.querySelector('.product-gallery__slide.is-active');
              if (activeSlide) {
                img = activeSlide.querySelector('img[data-zoom-url]');
              }
            }
          }

          if (!img) return;

          const zoomUrl = img.dataset.zoomUrl;
          if (zoomUrl) {
            zoomImage.src = zoomUrl;
            zoomImage.alt = img.alt || '';
            zoomModal.showModal();
          }
        });
      });

      // Close on button click
      if (zoomClose) {
        zoomClose.addEventListener('click', () => {
          zoomModal.close();
        });
      }

      // Close on backdrop click
      zoomModal.addEventListener('click', (e) => {
        if (e.target === zoomModal) {
          zoomModal.close();
        }
      });

      // Close on escape key (native dialog behavior, but ensure cleanup)
      zoomModal.addEventListener('close', () => {
        zoomImage.src = '';
      });
    }
  })();
</script>

{% stylesheet %}
  .main-product__grid {
    display: grid;
    gap: var(--space-8);
  }

  @media (min-width: 990px) {
    .main-product__grid {
      grid-template-columns: 3fr 2fr;
      gap: var(--space-16);
    }

    .main-product__grid--reverse {
      grid-template-columns: 2fr 3fr;
    }

    .main-product__grid--reverse .main-product__media {
      order: 2;
    }
  }

  .main-product__info {
    display: flex;
    flex-direction: column;
    gap: var(--space-5);
  }

  /* Product info block sectioning - borders between elements */
  .product-info__vendor,
  .product-info__title,
  .product-info__price,
  .product-info__description,
  .variant-picker,
  .product-info__quantity,
  .product-info__buy-buttons,
  .product-info__inventory,
  .product-info__sku,
  .product-info__rating,
  .product-info__share,
  .product-info__text,
  .product-info__complementary,
  .product-info__custom-liquid {
    padding-bottom: var(--space-4);
    border-bottom: 1px solid var(--color-border);
  }

  /* Trust badges already have borders - just ensure consistent padding */
  .product-info__trust-badges {
    padding-bottom: var(--space-4);
  }

  /* Remove border from last visible element */
  .main-product__info > form > *:last-child:not(.product-info__collapsible) {
    border-bottom: none;
    padding-bottom: 0;
  }

  /* Divider block is already a separator */
  .product-info__divider {
    border-bottom: none;
    padding-bottom: 0;
    margin: 0;
  }

  .main-product__info--sticky {
    position: sticky;
    top: calc(var(--header-height) + var(--space-4));
    align-self: start;
  }

  /* Override parent grid for stacked layout - make it single column full width */
  .product-gallery[data-layout="stacked"] {
    display: block;
  }

  .product-gallery__stacked {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
  }

  .product-gallery__stacked-item {
    position: relative;
  }

  /* Zoom Button - visible styling for contrast on images */
  .product-gallery__zoom {
    position: absolute;
    top: var(--space-3);
    right: var(--space-3);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    padding: 0;
    color: var(--color-foreground);
    background: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    opacity: 0.85;
    cursor: pointer;
    transition: opacity var(--duration-fast) var(--ease-out),
                background var(--duration-fast) var(--ease-out),
                color var(--duration-fast) var(--ease-out);
    z-index: 10;
  }

  .product-gallery__zoom:hover {
    opacity: 1;
    background: var(--color-foreground);
    color: var(--color-background);
  }

  .product-gallery__zoom svg {
    width: 1.25rem;
    height: 1.25rem;
  }

  /* Zoom Modal */
  .product-gallery__zoom-modal {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    max-width: 100%;
    max-height: 100%;
    margin: 0;
    padding: 0;
    border: none;
    background: rgba(0, 0, 0, 0.95);
    z-index: var(--z-modal);
  }

  .product-gallery__zoom-modal::backdrop {
    background: transparent;
  }

  .product-gallery__zoom-modal-content {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    padding: var(--space-8);
    overflow: auto;
  }

  .product-gallery__zoom-modal-content img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
  }

  .product-gallery__zoom-close {
    position: absolute;
    top: var(--space-4);
    right: var(--space-4);
    color: white;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    z-index: 1;
  }

  .product-gallery__zoom-close:hover {
    background: rgba(255, 255, 255, 0.2);
  }

  .product-info__collapsible:first-of-type {
    border-top: 1px solid var(--color-border);
  }

  .product-info__collapsible {
    border-bottom: 1px solid var(--color-border);
  }

  .product-info__collapsible-summary {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-5) 0;
    cursor: pointer;
    list-style: none;
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    letter-spacing: 0.02em;
    transition: opacity var(--duration-fast) var(--ease-out);
  }

  .product-info__collapsible-summary:hover {
    opacity: 0.7;
  }

  .product-info__collapsible-summary::-webkit-details-marker {
    display: none;
  }

  .product-info__collapsible-summary span {
    flex: 1;
  }

  .product-info__collapsible-summary svg:first-child {
    opacity: 0.6;
  }

  .product-info__collapsible-summary svg:last-child {
    transition: transform var(--duration-fast) var(--ease-out);
  }

  .product-info__collapsible[open] .product-info__collapsible-summary svg:last-child {
    transform: rotate(180deg);
  }

  .product-info__collapsible-content {
    padding-bottom: var(--space-5);
    font-size: var(--font-size-sm);
    line-height: var(--line-height-relaxed);
    opacity: 0.8;
    animation: collapsible-open var(--duration-normal, 0.3s) var(--ease-out) forwards;
  }

  @keyframes collapsible-open {
    from {
      opacity: 0;
      transform: translateY(-8px);
    }
    to {
      opacity: 0.8;
      transform: translateY(0);
    }
  }

  .product-info__inventory {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--font-size-sm);
  }

  .product-info__inventory-low {
    color: var(--color-error);
  }

  .product-info__inventory-in-stock {
    color: var(--color-success);
  }

  .product-info__inventory-low,
  .product-info__inventory-in-stock {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    margin: 0;
  }

  /* Title Size Variants */
  .product-info__title--small {
    font-size: var(--font-size-xl);
  }

  .product-info__title--medium {
    font-size: var(--font-size-2xl);
  }

  .product-info__title--large {
    font-size: var(--font-size-3xl);
  }

  /* Price Size Variants */
  .product-info__price--small .price__regular,
  .product-info__price--small .price__sale,
  .product-info__price--small .price__compare {
    font-size: var(--font-size-md);
  }

  .product-info__price--medium .price__regular,
  .product-info__price--medium .price__sale,
  .product-info__price--medium .price__compare {
    font-size: var(--font-size-lg);
  }

  .product-info__price--large .price__regular,
  .product-info__price--large .price__sale,
  .product-info__price--large .price__compare {
    font-size: var(--font-size-xl);
  }

  /* Inventory Pulsing Dot */
  .inventory-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
    animation: inventory-pulse 2s ease-in-out infinite;
  }

  .inventory-dot--in-stock {
    background: var(--color-success);
  }

  .inventory-dot--low-stock {
    background: var(--color-sale, #f59e0b);
  }

  @keyframes inventory-pulse {
    0%, 100% {
      opacity: 1;
      transform: scale(1);
    }
    50% {
      opacity: 0.5;
      transform: scale(1.2);
    }
  }

  .selling-plan-picker {
    padding: var(--space-4);
    border: var(--border-width) solid var(--border-color);
    border-radius: var(--radius-inputs);
  }

  .selling-plan-options {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    margin-top: var(--space-3);
  }

  .selling-plan-option {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    cursor: pointer;
  }

  .selling-plan-option__price {
    margin-left: auto;
    font-weight: 500;
  }

  .gift-card-recipient__fields {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
    margin-top: var(--space-4);
    padding: var(--space-4);
    border: var(--border-width) solid var(--border-color);
    border-radius: var(--radius-inputs);
  }

  .product-info__complementary {
    margin-top: var(--space-6);
  }

  .product-info__complementary-products {
    display: grid;
    grid-template-columns: repeat(var(--complementary-columns, 2), 1fr);
    gap: var(--space-4);
    margin-top: var(--space-4);
  }

  /* Variant Picker */
  .variant-picker {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
  }

  .variant-picker__option {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .variant-picker__label {
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    letter-spacing: 0.02em;
  }

  .variant-picker__values {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
  }

  /* Text/Size Values */
  .variant-picker__value {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 2.75rem;
    height: 2.75rem;
    padding: 0 var(--space-3);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    background: transparent;
    border: 1px solid var(--color-border);
    cursor: pointer;
    transition: all var(--duration-fast) var(--ease-out);
  }

  .variant-picker__value:hover:not(:disabled) {
    border-color: var(--color-foreground);
  }

  .variant-picker__value.is-selected {
    background-color: var(--color-foreground);
    color: var(--color-background);
    border-color: var(--color-foreground);
  }

  .variant-picker__value.is-unavailable {
    opacity: 0.4;
    cursor: not-allowed;
    position: relative;
  }

  .variant-picker__value.is-unavailable::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background: var(--color-foreground);
    transform: rotate(-12deg);
  }

  /* Color Swatches - Luxury Styling */
  .variant-picker__swatch {
    width: 2.25rem;
    height: 2.25rem;
    padding: 0;
    border-radius: 50%;
    border: 1px solid var(--color-border);
    background-color: var(--swatch-color, #ccc);
    background-image: var(--swatch-image);
    background-size: cover;
    background-position: center;
    cursor: pointer;
    transition: transform var(--duration-fast) var(--ease-out),
                box-shadow var(--duration-fast) var(--ease-out);
  }

  .variant-picker__swatch:hover:not(:disabled) {
    transform: scale(1.1);
  }

  .variant-picker__swatch.is-selected {
    box-shadow: 0 0 0 2px var(--color-background),
                0 0 0 3px var(--color-foreground);
  }

  .variant-picker__swatch.is-unavailable {
    opacity: 0.4;
    cursor: not-allowed;
    position: relative;
  }

  .variant-picker__swatch.is-unavailable::after {
    content: '';
    position: absolute;
    top: 50%;
    left: -2px;
    right: -2px;
    height: 1px;
    background: var(--color-foreground);
    transform: rotate(-45deg);
  }

  /* Trust Badges */
  .product-info__trust-badges {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-4);
    padding: var(--space-4) 0;
    border-top: 1px solid var(--color-border);
    border-bottom: 1px solid var(--color-border);
  }

  .trust-badge {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--font-size-xs);
    letter-spacing: 0.02em;
    color: var(--color-muted);
  }

  .trust-badge svg {
    opacity: 0.6;
  }

  /* Buy Buttons Enhancement */
  .product-info__buy-buttons .btn--filled {
    min-height: var(--button-height-lg);
    font-size: var(--font-size-sm);
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }

  .product-info__buy-buttons .btn--filled:hover:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .product-info__buy-buttons .shopify-payment-button {
    margin-top: var(--space-3);
  }

  .product-info__buy-buttons .shopify-payment-button__button {
    min-height: var(--button-height-lg);
  }

  /* ========================================
     PICKUP AVAILABILITY
     ======================================== */
  .pickup-availability {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .pickup-availability__summary {
    display: flex;
    align-items: flex-start;
    gap: var(--space-2);
    font-size: var(--font-size-sm);
  }

  .pickup-availability__icon {
    flex-shrink: 0;
    margin-top: 0.125em;
  }

  .pickup-availability__icon--available {
    color: var(--color-success, #22c55e);
  }

  .pickup-availability__icon--unavailable {
    color: var(--color-error, #ef4444);
  }

  .pickup-availability__time {
    margin: 0;
    padding-left: calc(var(--space-2) + 1rem);
  }

  .pickup-availability__button {
    display: inline-block;
    padding: 0;
    background: none;
    border: none;
    cursor: pointer;
    text-align: left;
  }

  /* Pickup Availability Drawer */
  .pickup-availability__modal {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: auto;
    width: min(100vw, 400px);
    max-width: 100%;
    max-height: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
    border: none;
    border-left: 1px solid var(--color-border);
    border-radius: 0;
    background: var(--color-background);
  }

  .pickup-availability__modal[open] {
    animation: drawer-slide-in var(--duration-normal) var(--ease-out) forwards;
  }

  @keyframes drawer-slide-in {
    from {
      transform: translateX(100%);
    }
    to {
      transform: translateX(0);
    }
  }

  .pickup-availability__modal::backdrop {
    background: rgba(0, 0, 0, 0.5);
  }

  .pickup-availability__modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-3) var(--space-4);
    background-color: var(--color-foreground);
    color: var(--color-background);
  }

  .pickup-availability__modal-header .icon {
    color: var(--color-background);
  }

  .pickup-availability__modal-close {
    color: var(--color-background);
    background: transparent;
    border: none;
  }

  .pickup-availability__modal-close:hover {
    opacity: 0.7;
  }

  .pickup-availability__modal-title {
    font-family: var(--font-heading-family);
    font-size: var(--font-size-xs);
    font-weight: 600;
    letter-spacing: var(--letter-spacing-widest);
    text-transform: uppercase;
    margin: 0;
  }

  .pickup-availability__modal-content {
    padding: var(--space-5);
    overflow-y: auto;
    height: calc(100% - 50px);
  }

  .pickup-availability__stores {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
  }

  .pickup-availability__store {
    padding-bottom: var(--space-4);
    border-bottom: 1px solid var(--color-border);
  }

  .pickup-availability__store:last-child {
    padding-bottom: 0;
    border-bottom: none;
  }

  .pickup-availability__store-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: var(--space-3);
    margin-bottom: var(--space-2);
  }

  .pickup-availability__store-name {
    font-weight: 600;
  }

  .pickup-availability__store-status {
    display: flex;
    align-items: center;
    gap: var(--space-1);
    font-size: var(--font-size-sm);
    white-space: nowrap;
  }

  .pickup-availability__store-status--available {
    color: var(--color-success, #22c55e);
  }

  .pickup-availability__store-status--unavailable {
    color: var(--color-error, #ef4444);
  }

  .pickup-availability__store-address {
    font-style: normal;
    line-height: 1.5;
  }

  /* ========================================
     PRODUCT RATING
     ======================================== */
  .product-rating {
    display: flex;
    align-items: center;
    gap: var(--space-1);
  }

  .product-rating svg {
    color: var(--color-foreground);
  }

  .product-rating__count {
    margin-left: var(--space-2);
    font-size: var(--font-size-sm);
    color: var(--color-muted);
  }

  /* ========================================
     BLOCK SPACING UTILITIES
     ======================================== */
  .spacing-bottom--none {
    margin-bottom: 0;
  }

  .spacing-bottom--small {
    margin-bottom: var(--space-3);
  }

  .spacing-bottom--medium {
    margin-bottom: var(--space-5);
  }

  .spacing-bottom--large {
    margin-bottom: var(--space-8);
  }
{% endstylesheet %}

{% schema %}
{
  "name": "t:sections.main_product.name",
  "class": "section-main-product",
  "tag": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_sticky",
      "label": "t:sections.main_product.settings.enable_sticky.label",
      "default": true
    },
    {
      "type": "select",
      "id": "media_position",
      "label": "t:sections.main_product.settings.media_position.label",
      "options": [
        { "value": "left", "label": "t:sections.main_product.settings.media_position.options.left" },
        { "value": "right", "label": "t:sections.main_product.settings.media_position.options.right" }
      ],
      "default": "left"
    },
    {
      "type": "select",
      "id": "gallery_layout",
      "label": "t:sections.main_product.settings.gallery_layout.label",
      "options": [
        { "value": "thumbnails", "label": "t:sections.main_product.settings.gallery_layout.options.thumbnails" },
        { "value": "stacked", "label": "t:sections.main_product.settings.gallery_layout.options.stacked" }
      ],
      "default": "thumbnails"
    },
    {
      "type": "checkbox",
      "id": "enable_zoom",
      "label": "t:sections.main_product.settings.enable_zoom.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_video_looping",
      "label": "t:sections.main_product.settings.enable_video_looping.label",
      "default": false
    },
    {
      "type": "range",
      "id": "visible_thumbnails",
      "min": 3,
      "max": 6,
      "step": 1,
      "label": "t:sections.main_product.settings.visible_thumbnails.label",
      "default": 4,
      "visible_if": "{{ section.settings.gallery_layout == 'thumbnails' }}"
    },
    {
      "type": "checkbox",
      "id": "show_image_counter",
      "label": "t:sections.main_product.settings.show_image_counter.label",
      "default": true,
      "visible_if": "{{ section.settings.gallery_layout == 'thumbnails' }}"
    },
    {
      "type": "checkbox",
      "id": "show_nav_arrows",
      "label": "t:sections.main_product.settings.show_nav_arrows.label",
      "default": true,
      "visible_if": "{{ section.settings.gallery_layout == 'thumbnails' }}"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:labels.color_scheme",
      "default": "scheme_1"
    }
  ],
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "title",
      "name": "t:sections.main_product.blocks.title.name",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "title_size",
          "label": "Title size",
          "options": [
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "large"
        },
        {
          "type": "select",
          "id": "spacing_bottom",
          "label": "Bottom spacing",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "small"
        }
      ]
    },
    {
      "type": "price",
      "name": "t:sections.main_product.blocks.price.name",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "price_size",
          "label": "Price size",
          "options": [
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "large"
        },
        {
          "type": "checkbox",
          "id": "show_installments",
          "label": "Show Shop Pay Installments",
          "default": true
        },
        {
          "type": "select",
          "id": "spacing_bottom",
          "label": "Bottom spacing",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "small"
        }
      ]
    },
    {
      "type": "vendor",
      "name": "t:sections.main_product.blocks.vendor.name",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "spacing_bottom",
          "label": "Bottom spacing",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "small"
        }
      ]
    },
    {
      "type": "description",
      "name": "t:sections.main_product.blocks.description.name",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "spacing_bottom",
          "label": "Bottom spacing",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "small"
        }
      ]
    },
    {
      "type": "variant_picker",
      "name": "t:sections.main_product.blocks.variant_picker.name",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "style",
          "label": "t:sections.main_product.blocks.variant_picker.settings.style.label",
          "options": [
            { "value": "dropdown", "label": "t:sections.main_product.blocks.variant_picker.settings.style.options.dropdown" },
            { "value": "buttons", "label": "t:sections.main_product.blocks.variant_picker.settings.style.options.buttons" }
          ],
          "default": "dropdown"
        },
        {
          "type": "select",
          "id": "swatch_type",
          "label": "t:sections.main_product.blocks.variant_picker.settings.swatch_type.label",
          "options": [
            { "value": "none", "label": "t:sections.main_product.blocks.variant_picker.settings.swatch_type.options.none" },
            { "value": "color", "label": "t:sections.main_product.blocks.variant_picker.settings.swatch_type.options.color" },
            { "value": "image", "label": "t:sections.main_product.blocks.variant_picker.settings.swatch_type.options.image" }
          ],
          "default": "color"
        },
        {
          "type": "select",
          "id": "spacing_bottom",
          "label": "Bottom spacing",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "small"
        }
      ]
    },
    {
      "type": "quantity_selector",
      "name": "t:sections.main_product.blocks.quantity_selector.name",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "spacing_bottom",
          "label": "Bottom spacing",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "small"
        }
      ]
    },
    {
      "type": "buy_buttons",
      "name": "t:sections.main_product.blocks.buy_buttons.name",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_dynamic_checkout",
          "label": "t:sections.main_product.blocks.buy_buttons.settings.show_dynamic_checkout.label",
          "default": true
        },
        {
          "type": "select",
          "id": "spacing_bottom",
          "label": "Bottom spacing",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "small"
        }
      ]
    },
    {
      "type": "inventory",
      "name": "t:sections.main_product.blocks.inventory.name",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "indicator_style",
          "label": "Indicator style",
          "options": [
            { "value": "icon", "label": "Icon" },
            { "value": "dot", "label": "Pulsing dot" }
          ],
          "default": "icon"
        },
        {
          "type": "range",
          "id": "inventory_threshold",
          "min": 1,
          "max": 50,
          "step": 1,
          "label": "t:sections.main_product.blocks.inventory.settings.inventory_threshold.label",
          "default": 10
        },
        {
          "type": "checkbox",
          "id": "show_count",
          "label": "t:sections.main_product.blocks.inventory.settings.show_count.label",
          "default": true
        },
        {
          "type": "select",
          "id": "spacing_bottom",
          "label": "Bottom spacing",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "small"
        }
      ]
    },
    {
      "type": "pickup_availability",
      "name": "Pickup availability",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "spacing_bottom",
          "label": "Bottom spacing",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "small"
        }
      ]
    },
    {
      "type": "sku",
      "name": "t:sections.main_product.blocks.sku.name",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "spacing_bottom",
          "label": "Bottom spacing",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "small"
        }
      ]
    },
    {
      "type": "rating",
      "name": "t:sections.main_product.blocks.rating.name",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "spacing_bottom",
          "label": "Bottom spacing",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "small"
        }
      ]
    },
    {
      "type": "share",
      "name": "t:sections.main_product.blocks.share.name",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_facebook",
          "label": "Show Facebook",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_twitter",
          "label": "Show X (Twitter)",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_pinterest",
          "label": "Show Pinterest",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_email",
          "label": "Show Email",
          "default": true
        },
        {
          "type": "select",
          "id": "spacing_bottom",
          "label": "Bottom spacing",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "small"
        }
      ]
    },
    {
      "type": "collapsible_tab",
      "name": "t:sections.main_product.blocks.collapsible_tab.name",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "t:sections.main_product.blocks.collapsible_tab.settings.heading.label",
          "default": "Shipping & Returns"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "t:sections.main_product.blocks.collapsible_tab.settings.content.label",
          "default": "<p>Share shipping and returns information.</p>"
        },
        {
          "type": "page",
          "id": "page",
          "label": "t:sections.main_product.blocks.collapsible_tab.settings.page.label"
        },
        {
          "type": "select",
          "id": "icon",
          "label": "t:sections.main_product.blocks.collapsible_tab.settings.icon.label",
          "options": [
            { "value": "none", "label": "t:sections.main_product.blocks.collapsible_tab.settings.icon.options.none" },
            { "value": "truck", "label": "t:sections.main_product.blocks.collapsible_tab.settings.icon.options.truck" },
            { "value": "package", "label": "t:sections.main_product.blocks.collapsible_tab.settings.icon.options.package" },
            { "value": "refresh", "label": "t:sections.main_product.blocks.collapsible_tab.settings.icon.options.refresh" },
            { "value": "lock", "label": "t:sections.main_product.blocks.collapsible_tab.settings.icon.options.lock" },
            { "value": "info", "label": "t:sections.main_product.blocks.collapsible_tab.settings.icon.options.info" }
          ],
          "default": "truck"
        },
        {
          "type": "select",
          "id": "spacing_bottom",
          "label": "Bottom spacing",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "small"
        }
      ]
    },
    {
      "type": "popup",
      "name": "t:sections.main_product.blocks.popup.name",
      "settings": [
        {
          "type": "text",
          "id": "link_label",
          "label": "t:sections.main_product.blocks.popup.settings.link_label.label",
          "default": "Size guide"
        },
        {
          "type": "page",
          "id": "page",
          "label": "t:sections.main_product.blocks.popup.settings.page.label"
        },
        {
          "type": "select",
          "id": "spacing_bottom",
          "label": "Bottom spacing",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "small"
        }
      ]
    },
    {
      "type": "complementary",
      "name": "t:sections.main_product.blocks.complementary.name",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "t:sections.main_product.blocks.complementary.settings.heading.label",
          "default": "Pair it with"
        },
        {
          "type": "range",
          "id": "products_to_show",
          "min": 2,
          "max": 8,
          "step": 1,
          "label": "t:sections.main_product.blocks.complementary.settings.products_to_show.label",
          "default": 4
        },
        {
          "type": "select",
          "id": "columns",
          "label": "t:labels.columns_desktop",
          "options": [
            { "value": "1", "label": "1" },
            { "value": "2", "label": "2" }
          ],
          "default": "2"
        },
        {
          "type": "select",
          "id": "spacing_bottom",
          "label": "Bottom spacing",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "small"
        }
      ]
    },
    {
      "type": "custom_liquid",
      "name": "t:sections.main_product.blocks.custom_liquid.name",
      "settings": [
        {
          "type": "liquid",
          "id": "liquid",
          "label": "Custom Liquid"
        },
        {
          "type": "select",
          "id": "spacing_bottom",
          "label": "Bottom spacing",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "small"
        }
      ]
    },
    {
      "type": "text",
      "name": "t:sections.main_product.blocks.text.name",
      "settings": [
        {
          "type": "richtext",
          "id": "text",
          "label": "t:sections.main_product.blocks.text.settings.text.label",
          "default": "<p>Text block</p>"
        },
        {
          "type": "select",
          "id": "text_style",
          "label": "t:sections.main_product.blocks.text.settings.text_style.label",
          "options": [
            { "value": "body", "label": "t:sections.main_product.blocks.text.settings.text_style.options.body" },
            { "value": "small", "label": "t:sections.main_product.blocks.text.settings.text_style.options.small" },
            { "value": "uppercase", "label": "t:sections.main_product.blocks.text.settings.text_style.options.uppercase" }
          ],
          "default": "body"
        },
        {
          "type": "select",
          "id": "spacing_bottom",
          "label": "Bottom spacing",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "small"
        }
      ]
    },
    {
      "type": "trust_badges",
      "name": "Trust badges",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_shipping",
          "label": "Show shipping badge",
          "default": true
        },
        {
          "type": "text",
          "id": "shipping_text",
          "label": "Shipping text",
          "default": "Free shipping"
        },
        {
          "type": "checkbox",
          "id": "show_returns",
          "label": "Show returns badge",
          "default": true
        },
        {
          "type": "text",
          "id": "returns_text",
          "label": "Returns text",
          "default": "Easy returns"
        },
        {
          "type": "checkbox",
          "id": "show_secure",
          "label": "Show secure badge",
          "default": true
        },
        {
          "type": "text",
          "id": "secure_text",
          "label": "Secure text",
          "default": "Secure checkout"
        },
        {
          "type": "select",
          "id": "spacing_bottom",
          "label": "Bottom spacing",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "small"
        }
      ]
    },
    {
      "type": "divider",
      "name": "t:sections.main_product.blocks.divider.name",
      "settings": [
        {
          "type": "select",
          "id": "spacing_bottom",
          "label": "Bottom spacing",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "small"
        }
      ]
    }
  ]
}
{% endschema %}
