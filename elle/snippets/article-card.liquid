{% comment %}
  Article Card Snippet - Elle Theme
  Renders a blog article card with editorial styling

  Usage:
  {% render 'article-card', article: article %}
  {% render 'article-card', article: article, show_date: true, show_excerpt: true %}

  Parameters:
  - article: (required) Article object
  - show_date: (optional) Show publish date, default true
  - show_author: (optional) Show author name, default true
  - show_tags: (optional) Show article tags, default false
  - show_excerpt: (optional) Show excerpt, default true
  - show_image: (optional) Show featured image, default true
  - show_read_time: (optional) Show estimated read time, default true
  - image_ratio: (optional) 'landscape', 'portrait', 'square', default 'landscape'
  - heading_size: (optional) 'h3', 'h4', 'h5', default 'h4'
  - featured: (optional) Is this a featured/hero card, default false
{% endcomment %}

{%- liquid
  assign show_date = show_date | default: true, allow_false: true
  assign show_author = show_author | default: true, allow_false: true
  assign show_tags = show_tags | default: false, allow_false: true
  assign show_excerpt = show_excerpt | default: true, allow_false: true
  assign show_image = show_image | default: true, allow_false: true
  assign show_read_time = show_read_time | default: true, allow_false: true
  assign image_ratio = image_ratio | default: 'landscape'
  assign heading_size = heading_size | default: 'h4'
  assign featured = featured | default: false

  case image_ratio
    when 'portrait'
      assign aspect_ratio = 'portrait'
    when 'square'
      assign aspect_ratio = 'square'
    else
      assign aspect_ratio = 'landscape'
  endcase

  # Calculate read time
  assign word_count = article.content | strip_html | split: ' ' | size
  assign read_time = word_count | divided_by: 250
  if read_time < 1
    assign read_time = 1
  endif
-%}

<div class="article-card{% if featured %} article-card--featured{% endif %}{% if settings.enable_image_zoom %} hover-zoom{% endif %}">
  {%- if show_image and article.image -%}
    <a href="{{ article.url }}" class="article-card__media-link" aria-hidden="true" tabindex="-1">
      <div class="article-card__media media aspect-{{ aspect_ratio }}">
        {{
          article.image
          | image_url: width: 1200
          | image_tag:
            loading: 'lazy',
            sizes: '(min-width: 1200px) 50vw, (min-width: 750px) 50vw, 100vw',
            widths: '300, 450, 600, 800, 1000, 1200',
            class: 'article-card__image',
            alt: article.image.alt | default: article.title
        }}
      </div>
    </a>
  {%- elsif show_image -%}
    <div class="article-card__media article-card__media--placeholder media aspect-{{ aspect_ratio }}">
      <svg class="article-card__placeholder-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
        <rect x="3" y="3" width="18" height="18" rx="2"/>
        <circle cx="8.5" cy="8.5" r="1.5"/>
        <path d="m21 15-5-5L5 21"/>
      </svg>
    </div>
  {%- endif -%}

  <div class="article-card__content">
    {%- comment -%} Category + Read Time Row {%- endcomment -%}
    {%- if show_tags and article.tags.size > 0 or show_read_time -%}
      <div class="article-card__meta-top">
        {%- if show_tags and article.tags.size > 0 -%}
          <a href="{{ blog.url }}/tagged/{{ article.tags.first | handle }}" class="article-card__category">
            {{ article.tags.first }}
          </a>
        {%- endif -%}
        {%- if show_tags and article.tags.size > 0 and show_read_time -%}
          <span class="article-card__divider" aria-hidden="true"></span>
        {%- endif -%}
        {%- if show_read_time -%}
          <span class="article-card__read-time">
            {{ read_time }} {{ 'article.min_read' | t }}
          </span>
        {%- endif -%}
      </div>
    {%- endif -%}

    <h3 class="article-card__title {{ heading_size }}">
      <a href="{{ article.url }}">{{ article.title }}</a>
    </h3>

    {%- if show_excerpt and article.excerpt_or_content != blank -%}
      <p class="article-card__excerpt">
        {%- if featured -%}
          {{ article.excerpt_or_content | strip_html | truncate: 250 }}
        {%- else -%}
          {{ article.excerpt_or_content | strip_html | truncate: 120 }}
        {%- endif -%}
      </p>
    {%- endif -%}

    {%- if show_author or show_date -%}
      <div class="article-card__meta">
        {%- if show_author -%}
          <span class="article-card__author">
            {{ article.author }}
          </span>
        {%- endif -%}
        {%- if show_author and show_date -%}
          <span class="article-card__separator" aria-hidden="true"></span>
        {%- endif -%}
        {%- if show_date -%}
          <time class="article-card__date" datetime="{{ article.published_at | date: '%Y-%m-%d' }}">
            {{ article.published_at | date: format: 'abbreviated_date' }}
          </time>
        {%- endif -%}
      </div>
    {%- endif -%}
  </div>
</div>
