{% comment %}
  Image with Text Section - Influence Theme
  Versatile content + image layout with multiple positioning options
{% endcomment %}

{%- liquid
  assign image_position = section.settings.image_position
  assign desktop_layout = section.settings.desktop_layout
  assign image_ratio = section.settings.image_ratio
  assign mobile_image_position = section.settings.mobile_image_position
  assign padding = section.settings.padding
-%}

<section class="image-with-text section section--{{ padding }} {% render 'color-scheme', scheme: section.settings.color_scheme %}">
  {%- comment -%} Determine image reveal direction based on position {%- endcomment -%}
  {%- assign image_reveal = 'reveal' -%}
  {%- if image_position == 'right' -%}
    {%- assign image_reveal = 'reveal-right' -%}
  {%- endif -%}

  <div class="image-with-text__grid image-with-text__grid--{{ desktop_layout }}{% if image_position == 'right' %} image-with-text__grid--reverse{% endif %}{% if mobile_image_position == 'bottom' %} image-with-text__grid--mobile-reverse{% endif %}">
    {%- comment -%} Image with reveal animation {%- endcomment -%}
    <div class="image-with-text__media image-with-text__media--{{ image_ratio }}" data-animate="{{ image_reveal }}">
      {%- if section.settings.image != blank -%}
        {%- assign focal_point = section.settings.image.presentation.focal_point | default: '50% 50%' -%}
        {{
          section.settings.image
          | image_url: width: 1200
          | image_tag:
            loading: 'lazy',
            sizes: '(min-width: 990px) 50vw, 100vw',
            widths: '375, 550, 750, 1000, 1200',
            class: 'image-with-text__image',
            style: 'object-position: ' | append: focal_point | append: ';'
        }}
      {%- else -%}
        {{ 'image' | placeholder_svg_tag: 'image-with-text__placeholder' }}
      {%- endif -%}
    </div>

    {%- comment -%} Content with staggered animations {%- endcomment -%}
    <div class="image-with-text__content text-{{ section.settings.content_alignment }}">
      <div class="image-with-text__content-inner">
        {%- assign animation_index = 0 -%}
        {%- for block in section.blocks -%}
          {%- assign animation_delay = animation_index | times: 100 | plus: 200 -%}
          {%- case block.type -%}
            {%- when 'subheading' -%}
              {%- if block.settings.text != blank -%}
                <p
                  class="image-with-text__subheading subheading"
                  data-animate="fade"
                  style="--delay: {{ animation_delay }}ms"
                  {{ block.shopify_attributes }}
                >
                  {{ block.settings.text }}
                </p>
                {%- assign animation_index = animation_index | plus: 1 -%}
              {%- endif -%}

            {%- when 'heading' -%}
              {%- if block.settings.text != blank -%}
                {%- assign heading_size = block.settings.heading_size | default: 'h2' -%}
                <{{ heading_size }}
                  class="image-with-text__heading {{ heading_size }}"
                  data-animate
                  style="--delay: {{ animation_delay }}ms"
                  {{ block.shopify_attributes }}
                >
                  {{ block.settings.text }}
                </{{ heading_size }}>
                {%- assign animation_index = animation_index | plus: 1 -%}
              {%- endif -%}

            {%- when 'text' -%}
              {%- if block.settings.text != blank -%}
                <div
                  class="image-with-text__text rte"
                  data-animate
                  style="--delay: {{ animation_delay }}ms"
                  {{ block.shopify_attributes }}
                >
                  {{ block.settings.text }}
                </div>
                {%- assign animation_index = animation_index | plus: 1 -%}
              {%- endif -%}

            {%- when 'button' -%}
              {%- if block.settings.label != blank -%}
                <div
                  class="image-with-text__button"
                  data-animate="pop"
                  style="--delay: {{ animation_delay }}ms"
                  {{ block.shopify_attributes }}
                >
                  <a
                    href="{{ block.settings.link }}"
                    class="btn btn--{{ block.settings.style }}"
                  >
                    {{ block.settings.label }}
                  </a>
                </div>
                {%- assign animation_index = animation_index | plus: 1 -%}
              {%- endif -%}
          {%- endcase -%}
        {%- endfor -%}
      </div>
    </div>
  </div>
</section>

{% stylesheet %}
  .image-with-text {
    padding-inline: 0;
  }

  /* Section padding variants */
  .image-with-text.section--none {
    padding-block: 0;
  }

  .image-with-text.section--small {
    padding-block: var(--section-spacing-sm);
  }

  .image-with-text.section--medium {
    padding-block: var(--section-spacing-md);
  }

  .image-with-text.section--large {
    padding-block: var(--section-spacing-lg);
  }

  .image-with-text__grid {
    display: grid;
    gap: var(--space-8);
    align-items: center;
  }

  /* Mobile image position */
  @media (max-width: 989px) {
    .image-with-text__grid--mobile-reverse .image-with-text__media {
      order: 2;
    }
  }

  @media (min-width: 990px) {
    .image-with-text__grid {
      gap: 0;
    }

    /* Desktop layout widths */
    .image-with-text__grid--50-50 {
      grid-template-columns: 1fr 1fr;
    }

    .image-with-text__grid--60-40 {
      grid-template-columns: 3fr 2fr;
    }

    .image-with-text__grid--40-60 {
      grid-template-columns: 2fr 3fr;
    }

    .image-with-text__grid--reverse .image-with-text__media {
      order: 2;
    }

    /* Flip ratios when image position is reversed */
    .image-with-text__grid--60-40.image-with-text__grid--reverse {
      grid-template-columns: 2fr 3fr;
    }

    .image-with-text__grid--40-60.image-with-text__grid--reverse {
      grid-template-columns: 3fr 2fr;
    }
  }

  .image-with-text__media {
    position: relative;
    overflow: hidden;
    background-color: var(--color-muted);
  }

  /* Image aspect ratios */
  .image-with-text__media--portrait {
    aspect-ratio: 4 / 5;
  }

  .image-with-text__media--square {
    aspect-ratio: 1 / 1;
  }

  .image-with-text__media--landscape {
    aspect-ratio: 4 / 3;
  }

  .image-with-text__media--adapt {
    aspect-ratio: auto;
  }

  .image-with-text__media--adapt .image-with-text__image {
    position: relative;
    height: auto;
  }

  .image-with-text__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .image-with-text__placeholder {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .image-with-text__content {
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: var(--space-8) var(--page-margin);
  }

  @media (min-width: 990px) {
    .image-with-text__content {
      padding: var(--space-16) var(--space-12);
    }
  }

  .image-with-text__content.text-center {
    align-items: center;
  }

  .image-with-text__content-inner {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
    max-width: 32rem;
  }

  .image-with-text__subheading {
    margin-bottom: var(--space-1);
  }

  .image-with-text__button {
    margin-top: var(--space-4);
  }
{% endstylesheet %}

{% schema %}
{
  "name": "t:sections.image_with_text.name",
  "class": "section-image-with-text",
  "tag": "section",
  "settings": [
    {
      "type": "image_picker",
      "id": "image",
      "label": "t:sections.image_with_text.settings.image.label"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "t:sections.image_with_text.settings.image_ratio.label",
      "options": [
        { "value": "portrait", "label": "t:sections.image_with_text.settings.image_ratio.options.portrait" },
        { "value": "square", "label": "t:sections.image_with_text.settings.image_ratio.options.square" },
        { "value": "landscape", "label": "t:sections.image_with_text.settings.image_ratio.options.landscape" },
        { "value": "adapt", "label": "t:sections.image_with_text.settings.image_ratio.options.adapt" }
      ],
      "default": "portrait"
    },
    {
      "type": "header",
      "content": "t:labels.layout"
    },
    {
      "type": "select",
      "id": "desktop_layout",
      "label": "t:sections.image_with_text.settings.desktop_layout.label",
      "options": [
        { "value": "50-50", "label": "t:sections.image_with_text.settings.desktop_layout.options.50_50" },
        { "value": "60-40", "label": "t:sections.image_with_text.settings.desktop_layout.options.60_40" },
        { "value": "40-60", "label": "t:sections.image_with_text.settings.desktop_layout.options.40_60" }
      ],
      "default": "50-50"
    },
    {
      "type": "select",
      "id": "image_position",
      "label": "t:sections.image_with_text.settings.image_position.label",
      "options": [
        { "value": "left", "label": "t:sections.image_with_text.settings.image_position.options.left" },
        { "value": "right", "label": "t:sections.image_with_text.settings.image_position.options.right" }
      ],
      "default": "left"
    },
    {
      "type": "select",
      "id": "mobile_image_position",
      "label": "t:sections.image_with_text.settings.mobile_image_position.label",
      "options": [
        { "value": "top", "label": "t:sections.image_with_text.settings.mobile_image_position.options.top" },
        { "value": "bottom", "label": "t:sections.image_with_text.settings.mobile_image_position.options.bottom" }
      ],
      "default": "top"
    },
    {
      "type": "select",
      "id": "content_alignment",
      "label": "t:sections.image_with_text.settings.content_alignment.label",
      "options": [
        { "value": "left", "label": "t:sections.image_with_text.settings.content_alignment.options.left" },
        { "value": "center", "label": "t:sections.image_with_text.settings.content_alignment.options.center" }
      ],
      "default": "left"
    },
    {
      "type": "header",
      "content": "t:labels.section"
    },
    {
      "type": "select",
      "id": "padding",
      "label": "t:labels.padding",
      "options": [
        { "value": "none", "label": "t:options.padding.none" },
        { "value": "small", "label": "t:options.padding.small" },
        { "value": "medium", "label": "t:options.padding.medium" },
        { "value": "large", "label": "t:options.padding.large" }
      ],
      "default": "medium"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:labels.color_scheme",
      "default": "scheme_1"
    }
  ],
  "blocks": [
    {
      "type": "subheading",
      "name": "Subheading",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "t:labels.text",
          "default": "Subheading"
        }
      ]
    },
    {
      "type": "heading",
      "name": "t:sections.image_with_text.blocks.heading.name",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "t:labels.heading",
          "default": "Image with text"
        },
        {
          "type": "select",
          "id": "heading_size",
          "label": "t:labels.heading_size",
          "options": [
            { "value": "h1", "label": "t:options.heading_size.h1" },
            { "value": "h2", "label": "t:options.heading_size.h2" },
            { "value": "h3", "label": "t:options.heading_size.h3" }
          ],
          "default": "h2"
        }
      ]
    },
    {
      "type": "text",
      "name": "t:sections.image_with_text.blocks.text.name",
      "limit": 1,
      "settings": [
        {
          "type": "richtext",
          "id": "text",
          "label": "t:labels.text",
          "default": "<p>Pair text with an image to focus on your chosen product, collection, or blog post. Add details on availability, style, or even provide a review.</p>"
        }
      ]
    },
    {
      "type": "button",
      "name": "t:sections.image_with_text.blocks.button.name",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "t:labels.button_label",
          "default": "Shop now"
        },
        {
          "type": "url",
          "id": "link",
          "label": "t:labels.button_link"
        },
        {
          "type": "select",
          "id": "style",
          "label": "t:labels.button_style",
          "options": [
            { "value": "filled", "label": "t:options.button_style.filled" },
            { "value": "outline", "label": "t:options.button_style.outline" },
            { "value": "underline", "label": "t:options.button_style.underline" }
          ],
          "default": "filled"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.image_with_text.name",
      "blocks": [
        { "type": "subheading" },
        { "type": "heading" },
        { "type": "text" },
        { "type": "button" }
      ]
    }
  ]
}
{% endschema %}
